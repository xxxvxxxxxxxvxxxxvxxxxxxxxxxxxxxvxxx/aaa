(function(h,s,J,Z,E,p){"use strict";var{FormInput:M,FormSwitch:A,FormSection:T,FormDivider:C,FormRow:Me,FormText:m}=J.Forms,{View:ye,Text:S,ScrollView:Q,TouchableOpacity:R,StyleSheet:X}=s.ReactNative,r=X.create({button:{backgroundColor:"#5865F2",padding:12,borderRadius:8,alignItems:"center",marginVertical:8,marginHorizontal:16},successButton:{backgroundColor:"#3BA55D"},dangerButton:{backgroundColor:"#ED4245"},warningButton:{backgroundColor:"#FAA61A"},buttonText:{color:"white",fontWeight:"bold",fontSize:16},infoText:{color:"#B9BBBE",fontSize:14,marginHorizontal:16,marginVertical:8},warningText:{color:"#FAA61A",fontSize:13,marginHorizontal:16,marginVertical:4},codeText:{fontFamily:"monospace",backgroundColor:"#2F3136",padding:8,borderRadius:4,marginHorizontal:16,marginVertical:4,color:"#DCDDDE"}}),G=function(){Z.useProxy(E.storage);let[e,t]=s.React.useState(""),[a,i]=s.React.useState(""),[f,w]=s.React.useState(""),[U,H]=s.React.useState(""),[N,Y]=s.React.useState(""),[b,W]=s.React.useState(""),fe=async function(){if(!e.trim()){p.showToast("\u274C Enter target user ID","Small");return}if(!a.trim()){p.showToast("\u274C Enter sender user ID","Small");return}if(!f.trim()&&!U.trim()){p.showToast("\u274C Enter message content or embed","Small");return}let l=U||N||b?{title:U||void 0,description:N||void 0,image:b?{url:b}:void 0,thumbnail:b?{url:b}:void 0,type:"rich"}:void 0;await _({targetUserId:e.trim(),fromUserId:a.trim(),content:f.trim(),embed:l,persistent:!0})&&p.showToast("\u2705 Fake message sent!","Check")},Ee=async function(){if(!e.trim()||!a.trim()){p.showToast("\u274C Fill in both User IDs first","Small");return}await B(e.trim(),a.trim())},he=async function(){try{let l=await s.clipboard.getString();l&&(t(l.trim()),p.showToast("\u{1F4CB} Pasted target user ID","clipboard"))}catch{p.showToast("Failed to paste","Small")}},pe=async function(){try{let l=await s.clipboard.getString();l&&(i(l.trim()),p.showToast("\u{1F4CB} Pasted sender user ID","clipboard"))}catch{p.showToast("Failed to paste","Small")}},me=s.React.useMemo(function(){return Object.values(E.storage.persistentMessages||{}).reduce(function(l,q){return l+(Array.isArray(q)?q.length:0)},0)},[E.storage.persistentMessages]),Se=Object.keys(E.storage.persistentMessages||{}).length;return s.React.createElement(Q,null,s.React.createElement(T,{title:"MESSAGE FAKER"},s.React.createElement(m,{style:r.infoText},"\u{1F4AC} Inject fake messages into DMs from anyone."),s.React.createElement(A,{label:"Enable Plugin",subLabel:"Turn the plugin on/off",value:E.storage.enabled,onValueChange:function(l){E.storage.enabled=l,p.showToast(l?"\u2705 Enabled":"\u274C Disabled","Check")}}),s.React.createElement(A,{label:"Auto-Inject on Startup",subLabel:"Automatically show fake messages when Discord starts",value:E.storage.autoInjectOnStartup,onValueChange:function(l){E.storage.autoInjectOnStartup=l}}),s.React.createElement(A,{label:"Prevent Message Deletion",subLabel:"Fake messages can't be deleted (they reinject)",value:E.storage.preventMessageDeletion,onValueChange:function(l){E.storage.preventMessageDeletion=l}}),s.React.createElement(A,{label:"Debug Mode",subLabel:"Enable detailed logging",value:E.storage.debug,onValueChange:function(l){E.storage.debug=l}})),s.React.createElement(C,null),s.React.createElement(T,{title:"CREATE FAKE MESSAGE"},s.React.createElement(m,{style:r.infoText},"\u{1F4DD} Create a fake message in someone's DM"),s.React.createElement(M,{title:"TARGET USER ID (Whose DM)",placeholder:"User ID of person whose DM you want to inject into",value:e,onChange:t}),s.React.createElement(R,{style:r.button,onPress:he},s.React.createElement(S,{style:r.buttonText},"\u{1F4CB} Paste Target User ID")),s.React.createElement(M,{title:"FROM USER ID (Who message is from)",placeholder:"User ID of who the message appears to be from",value:a,onChange:i}),s.React.createElement(R,{style:r.button,onPress:pe},s.React.createElement(S,{style:r.buttonText},"\u{1F4CB} Paste Sender User ID")),s.React.createElement(M,{title:"MESSAGE CONTENT",placeholder:"The message text",value:f,onChange:w}),s.React.createElement(m,{style:r.infoText},"\u{1F4CE} Optional: Add an embed"),s.React.createElement(M,{title:"EMBED TITLE",placeholder:"Optional embed title",value:U,onChange:H}),s.React.createElement(M,{title:"EMBED DESCRIPTION",placeholder:"Optional embed description",value:N,onChange:Y}),s.React.createElement(M,{title:"EMBED IMAGE URL",placeholder:"Optional image URL",value:b,onChange:W}),s.React.createElement(R,{style:[r.button,r.successButton],onPress:fe},s.React.createElement(S,{style:r.buttonText},"\u2709\uFE0F Send Fake Message")),s.React.createElement(R,{style:[r.button,r.warningButton],onPress:Ee},s.React.createElement(S,{style:r.buttonText},"\u{1F9EA} Quick Test Message"))),s.React.createElement(C,null),s.React.createElement(T,{title:"CONSOLE API"},s.React.createElement(m,{style:r.infoText},"\u{1F527} You can also use the console for advanced usage:"),s.React.createElement(S,{style:r.codeText},`// Send fake message
__MESSAGE_FAKER__.fakeMessage({
  targetUserId: "USER_ID",
  fromUserId: "USER_ID",
  content: "Hello!",
  persistent: true
});`),s.React.createElement(S,{style:r.codeText},`// With embed
__MESSAGE_FAKER__.fakeMessage({
  targetUserId: "USER_ID",
  fromUserId: "USER_ID",
  content: "Check this out!",
  embed: {
    title: "Cool Title",
    description: "Description",
    image: { url: "https://..." }
  }
});`),s.React.createElement(m,{style:r.infoText},"Open Kettu debug console to use these commands")),s.React.createElement(C,null),s.React.createElement(T,{title:"STATISTICS"},s.React.createElement(m,{style:r.infoText},"\u{1F4CA} Current fake messages: ",me," messages in ",Se," channels")),s.React.createElement(C,null),s.React.createElement(T,{title:"DANGER ZONE"},s.React.createElement(R,{style:[r.button,r.dangerButton],onPress:function(){L(),t(""),i(""),w(""),H(""),Y(""),W("")}},s.React.createElement(S,{style:r.buttonText},"\u{1F5D1}\uFE0F Clear ALL Fake Messages")),s.React.createElement(m,{style:r.warningText},"\u26A0\uFE0F This will remove all fake messages from storage. They will disappear on next reload.")),s.React.createElement(m,{style:[r.infoText,{marginTop:16,marginBottom:32,textAlign:"center"}]},"MessageFaker v1.0.0 for Kettu/Bunny/Vendetta"))},ee=typeof window.bunny<"u",D=ee?window.bunny:window.vendetta,{findByProps:te,findByStoreName:se}=D.metro,{after:be,before:ae}=D.patcher,{storage:n}=D.plugin,{showToast:o}=D.ui?.toasts||{showToast:console.log};n.enabled??=!0,n.debug??=!1,n.persistentMessages??={},n.autoInjectOnStartup??=!0,n.preventMessageDeletion??=!0;var O=[],y=null,F=null,v=null,ne=null,k=null,u=null,c=function(e,t){n.debug&&console.log(`[MessageInjector] ${e}`,t||"")},d=function(e,t){console.error(`[MessageInjector] ${e}`,t||"")},x=function(e){return new Promise(function(t){return setTimeout(t,e)})};function I(e,t=[]){for(let a of e)try{let i=se(a);if(i&&(t.length===0||t.every(function(f){return typeof i[f]=="function"})))return c(`Found store: ${a}`),i}catch{}if(t.length>0)try{let a=te(...t);if(a)return c(`Found store by props: ${t.join(", ")}`),a}catch{}return null}async function re(e){try{if(v){let t=v.getUser?.(e);if(t)return{username:t.username||"Unknown User",discriminator:t.discriminator||"0",avatar:t.avatar?`https://cdn.discordapp.com/avatars/${e}/${t.avatar}.png`:null}}}catch(t){d("Failed to get user info",t)}return{username:"Unknown User",discriminator:"0",avatar:null}}function ie(e){try{if(F?.getDMFromUserId){let t=F.getDMFromUserId(e);return c(`DM channel for user ${e}: ${t}`),t}}catch(t){d("Failed to get DM channel",t)}return null}function le(){return`${Date.now()}${Math.random().toString(36).substring(2,11)}`}async function oe(e){let t=e.username,a=e.avatar;if(!t){let f=await re(e.userId);t=f.username,a||(a=f.avatar)}let i={id:e.messageId||le(),channel_id:e.channelId,author:{id:e.userId,username:t||"Unknown User",discriminator:"0",avatar:a||void 0,bot:!1,public_flags:0},content:e.content||"",timestamp:e.timestamp||new Date().toISOString(),edited_timestamp:null,tts:!1,mention_everyone:!1,mentions:[],mention_roles:[],attachments:[],embeds:e.embed?[e.embed]:[],reactions:[],pinned:!1,type:0,flags:0};return c("Created message object",i),i}function P(e){if(!y)return d("FluxDispatcher not available"),!1;try{return y.dispatch({type:"MESSAGE_CREATE",channelId:e.channel_id,message:e,optimistic:!1,sendMessageOptions:{},isPushNotification:!1}),c("Message injected successfully",e.id),!0}catch(t){return d("Failed to inject message",t),!1}}function j(){try{n.persistentMessages=JSON.parse(JSON.stringify(n.persistentMessages)),c("Saved persistent messages",Object.keys(n.persistentMessages).length)}catch(e){d("Failed to save persistent messages",e)}}async function _(e){try{let t=e.channelId;if(!t&&e.targetUserId&&(t=ie(e.targetUserId)),!t)return d("No valid channel ID found"),o&&o("Failed: Could not find DM channel","Small"),!1;let a=await oe({channelId:t,userId:e.fromUserId,content:e.content,username:e.username,avatar:e.avatar,embed:e.embed});e.persistent&&(n.persistentMessages[t]||(n.persistentMessages[t]=[]),n.persistentMessages[t].push(a),j(),c("Message saved to persistent storage",a.id));let i=P(a);return i&&c("Fake message sent successfully"),i}catch(t){return d("Failed to send fake message",t),o&&o("Failed to send fake message","Small"),!1}}function g(e){if(!n.persistentMessages[e])return;let t=n.persistentMessages[e];c(`Reinjecting ${t.length} messages for channel ${e}`),t.forEach(function(a,i){setTimeout(function(){P(a)},i*50)})}function ue(){try{if(!y)return;O.push(ae("dispatch",y,function(e){if(!n.enabled)return;let t=e[0];if(!(!t||!t.type)){if(n.preventMessageDeletion&&t.type==="MESSAGE_DELETE"){let a=t.id,i=t.channelId;if(i&&n.persistentMessages[i]){let f=n.persistentMessages[i].find(function(w){return w.id===a});f&&(c("Prevented deletion of fake message",a),e[0]={type:"NOOP"},setTimeout(function(){return P(f)},50))}}if(n.preventMessageDeletion&&t.type==="MESSAGE_DELETE_BULK"){let a=t.channelId;if(a&&n.persistentMessages[a]){let i=t.ids||[];n.persistentMessages[a].some(function(f){return i.includes(f.id)})&&(e[0]={type:"NOOP"},setTimeout(function(){return g(a)},100))}}if(t.type==="LOAD_MESSAGES_SUCCESS"||t.type==="LOAD_MESSAGES"){let a=t.channelId;a&&n.persistentMessages[a]&&(setTimeout(function(){return g(a)},200),setTimeout(function(){return g(a)},500),setTimeout(function(){return g(a)},1e3))}if((t.type==="CACHE_LOADED"||t.type==="OVERLAY_INITIALIZE"||t.type==="CHANNEL_UPDATES")&&u&&n.persistentMessages[u]&&setTimeout(function(){return u&&g(u)},300),(t.type==="USER_PROFILE_MODAL_OPEN"||t.type==="USER_PROFILE_MODAL_CLOSE"||t.type==="LAYER_PUSH"||t.type==="LAYER_POP"||t.type==="TYPING_START"||t.type==="TYPING_STOP")&&u&&n.persistentMessages[u]&&(setTimeout(function(){return u&&g(u)},50),setTimeout(function(){return u&&g(u)},300)),t.type==="MESSAGE_UPDATE"){let a=t.message?.channel_id;a&&n.persistentMessages[a]&&setTimeout(function(){return g(a)},100)}}})),c("Message persistence system setup with comprehensive event coverage")}catch(e){d("Failed to setup message persistence",e)}}function ce(){setInterval(function(){if(k)try{let e=k.getChannelId?.();e&&e!==u&&(u=e,n.persistentMessages[e]&&(g(e),setTimeout(function(){g(e)},200)))}catch{}},1e3),setInterval(function(){u&&n.persistentMessages[u]&&g(u)},2e3)}function L(){n.persistentMessages={},j(),c("Cleared all persistent messages"),o&&o("All fake messages cleared","Check")}function $(e){n.persistentMessages[e]&&(delete n.persistentMessages[e],j(),c(`Cleared messages for channel ${e}`),o&&o("Channel messages cleared","Check"))}function V(){return n.persistentMessages}async function B(e,t){return await _({targetUserId:e,fromUserId:t,content:"Test message from Message Injector plugin!",persistent:!0})}async function de(){try{y=I(["FluxDispatcher","Dispatcher"],["dispatch","subscribe"]),F=I(["ChannelStore"],["getChannel","getDMFromUserId"]),v=I(["UserStore","CurrentUserStore"],["getUser","getCurrentUser"]),ne=I(["MessageStore"],["getMessages","getMessage"]),k=I(["SelectedChannelStore"],["getChannelId"]);let e=y&&F&&v;return e?c("All critical modules loaded"):d("Some modules failed to load"),e}catch(e){return d("Failed to initialize modules",e),!1}}(async function(){try{if(console.log("[MessageInjector] Loading..."),await x(1e3),!await de()){d("Failed to load critical modules"),o&&o("Plugin failed to load","Small");return}if(ue(),ce(),n.autoInjectOnStartup){await x(2e3);let e=Object.keys(n.persistentMessages).length;e>0&&(c(`Auto-injecting messages for ${e} channels`),Object.keys(n.persistentMessages).forEach(function(t){setTimeout(function(){g(t)},500)}))}window.__MESSAGE_FAKER__={fakeMessage:_,clearAllMessages:L,clearChannelMessages:$,getAllMessages:V,quickTest:B,reinjectChannel:g,getStatus:function(){return{enabled:n.enabled,messageCount:Object.values(n.persistentMessages).reduce(function(e,t){return e+t.length},0),channelCount:Object.keys(n.persistentMessages).length}}},console.log("[MessageInjector] Loaded successfully"),o&&o("Message Injector loaded!","Check")}catch(e){d("Fatal error during load",e),o&&o("Plugin failed to load","Small")}})();var K=function(){},z=function(){try{for(let e of O)try{e()}catch{}O.length=0,window.__MESSAGE_FAKER__&&delete window.__MESSAGE_FAKER__,console.log("[MessageInjector] Unloaded"),o&&o("Plugin unloaded","Check")}catch(e){d("Error during unload",e)}},ge={onLoad:K,onUnload:z,settings:G};return h.clearAllMessages=L,h.clearChannelMessages=$,h.default=ge,h.fakeMessage=_,h.getAllMessages=V,h.onLoad=K,h.onUnload=z,h.quickTest=B,h.settings=G,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro.common,vendetta.ui.components,vendetta.storage,vendetta.plugin,vendetta.ui.toasts);
