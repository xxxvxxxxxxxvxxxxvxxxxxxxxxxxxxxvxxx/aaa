(function(h,s,B,W,a,o,b,q,J){"use strict";const{FormInput:M,FormSwitch:I,FormSection:p,FormDivider:C,FormRow:Ee,FormText:E}=q.Forms,{View:Se,Text:S,ScrollView:Z,TouchableOpacity:R,StyleSheet:Q}=s.ReactNative,l=Q.create({button:{backgroundColor:"#5865F2",padding:12,borderRadius:8,alignItems:"center",marginVertical:8,marginHorizontal:16},successButton:{backgroundColor:"#3BA55D"},dangerButton:{backgroundColor:"#ED4245"},warningButton:{backgroundColor:"#FAA61A"},buttonText:{color:"white",fontWeight:"bold",fontSize:16},infoText:{color:"#B9BBBE",fontSize:14,marginHorizontal:16,marginVertical:8},warningText:{color:"#FAA61A",fontSize:13,marginHorizontal:16,marginVertical:4},codeText:{fontFamily:"monospace",backgroundColor:"#2F3136",padding:8,borderRadius:4,marginHorizontal:16,marginVertical:4,color:"#DCDDDE"}});function U(){return window.__MESSAGE_FAKER__}function X(){J.useProxy(a.storage);const[e,t]=s.React.useState(""),[n,r]=s.React.useState(""),[g,m]=s.React.useState(""),[T,H]=s.React.useState(""),[x,z]=s.React.useState(""),[y,Y]=s.React.useState(""),ce=async function(){const i=U();if(!i){o.showToast("\u274C Plugin not ready","Small");return}if(!e.trim()){o.showToast("\u274C Enter target user ID","Small");return}if(!n.trim()){o.showToast("\u274C Enter sender user ID","Small");return}if(!g.trim()&&!T.trim()){o.showToast("\u274C Enter message content or embed","Small");return}const _=T||x||y?{title:T||void 0,description:x||void 0,image:y?{url:y}:void 0,thumbnail:y?{url:y}:void 0,type:"rich"}:void 0;try{await i.fakeMessage({targetUserId:e.trim(),fromUserId:n.trim(),content:g.trim(),embed:_,persistent:!0})&&o.showToast("\u2705 Fake message sent!","Check")}catch{o.showToast("\u274C Failed to send message","Small")}},ue=async function(){const i=U();if(!i){o.showToast("\u274C Plugin not ready","Small");return}if(!e.trim()||!n.trim()){o.showToast("\u274C Fill in both User IDs first","Small");return}try{await i.quickTest(e.trim(),n.trim())}catch{o.showToast("\u274C Test failed","Small")}},ge=async function(){try{const i=await s.clipboard.getString();i&&(t(i.trim()),o.showToast("\u{1F4CB} Pasted target user ID","clipboard"))}catch{o.showToast("Failed to paste","Small")}},de=async function(){try{const i=await s.clipboard.getString();i&&(r(i.trim()),o.showToast("\u{1F4CB} Pasted sender user ID","clipboard"))}catch{o.showToast("Failed to paste","Small")}},fe=s.React.useMemo(function(){return Object.values(a.storage.persistentMessages||{}).reduce(function(i,_){return i+(Array.isArray(_)?_.length:0)},0)},[a.storage.persistentMessages]),he=Object.keys(a.storage.persistentMessages||{}).length;return s.React.createElement(Z,null,s.React.createElement(p,{title:"MESSAGE FAKER"},s.React.createElement(E,{style:l.infoText},"\u{1F4AC} Inject fake messages into DMs from anyone."),s.React.createElement(I,{label:"Enable Plugin",subLabel:"Turn the plugin on/off",value:a.storage.enabled,onValueChange:function(i){a.storage.enabled=i,o.showToast(i?"\u2705 Enabled":"\u274C Disabled","Check")}}),s.React.createElement(I,{label:"Auto-Inject on Startup",subLabel:"Automatically show fake messages when Discord starts",value:a.storage.autoInjectOnStartup,onValueChange:function(i){a.storage.autoInjectOnStartup=i}}),s.React.createElement(I,{label:"Prevent Message Deletion",subLabel:"Fake messages can't be deleted (they reinject)",value:a.storage.preventMessageDeletion,onValueChange:function(i){a.storage.preventMessageDeletion=i}}),s.React.createElement(I,{label:"Debug Mode",subLabel:"Enable detailed logging",value:a.storage.debug,onValueChange:function(i){a.storage.debug=i}})),s.React.createElement(C,null),s.React.createElement(p,{title:"CREATE FAKE MESSAGE"},s.React.createElement(E,{style:l.infoText},"\u{1F4DD} Create a fake message in someone's DM"),s.React.createElement(M,{title:"TARGET USER ID (Whose DM)",placeholder:"User ID of person whose DM you want to inject into",value:e,onChange:t}),s.React.createElement(R,{style:l.button,onPress:ge},s.React.createElement(S,{style:l.buttonText},"\u{1F4CB} Paste Target User ID")),s.React.createElement(M,{title:"FROM USER ID (Who message is from)",placeholder:"User ID of who the message appears to be from",value:n,onChange:r}),s.React.createElement(R,{style:l.button,onPress:de},s.React.createElement(S,{style:l.buttonText},"\u{1F4CB} Paste Sender User ID")),s.React.createElement(M,{title:"MESSAGE CONTENT",placeholder:"The message text",value:g,onChange:m}),s.React.createElement(E,{style:l.infoText},"\u{1F4CE} Optional: Add an embed"),s.React.createElement(M,{title:"EMBED TITLE",placeholder:"Optional embed title",value:T,onChange:H}),s.React.createElement(M,{title:"EMBED DESCRIPTION",placeholder:"Optional embed description",value:x,onChange:z}),s.React.createElement(M,{title:"EMBED IMAGE URL",placeholder:"Optional image URL",value:y,onChange:Y}),s.React.createElement(R,{style:[l.button,l.successButton],onPress:ce},s.React.createElement(S,{style:l.buttonText},"\u2709\uFE0F Send Fake Message")),s.React.createElement(R,{style:[l.button,l.warningButton],onPress:ue},s.React.createElement(S,{style:l.buttonText},"\u{1F9EA} Quick Test Message"))),s.React.createElement(C,null),s.React.createElement(p,{title:"CONSOLE API"},s.React.createElement(E,{style:l.infoText},"\u{1F527} You can also use the console for advanced usage:"),s.React.createElement(S,{style:l.codeText},`// Send fake message
__MESSAGE_FAKER__.fakeMessage({
  targetUserId: "USER_ID",
  fromUserId: "USER_ID",
  content: "Hello!",
  persistent: true
});`),s.React.createElement(S,{style:l.codeText},`// With embed
__MESSAGE_FAKER__.fakeMessage({
  targetUserId: "USER_ID",
  fromUserId: "USER_ID",
  content: "Check this out!",
  embed: {
    title: "Cool Title",
    description: "Description",
    image: { url: "https://..." }
  }
});`),s.React.createElement(E,{style:l.infoText},"Open Kettu debug console to use these commands")),s.React.createElement(C,null),s.React.createElement(p,{title:"STATISTICS"},s.React.createElement(E,{style:l.infoText},"\u{1F4CA} Current fake messages: ",fe," messages in ",he," channels")),s.React.createElement(C,null),s.React.createElement(p,{title:"DANGER ZONE"},s.React.createElement(R,{style:[l.button,l.dangerButton],onPress:function(){const i=U();i&&i.clearAllMessages(),t(""),r(""),m(""),H(""),z(""),Y("")}},s.React.createElement(S,{style:l.buttonText},"\u{1F5D1}\uFE0F Clear ALL Fake Messages")),s.React.createElement(E,{style:l.warningText},"\u26A0\uFE0F This will remove all fake messages from storage. They will disappear on next reload.")),s.React.createElement(E,{style:[l.infoText,{marginTop:16,marginBottom:32,textAlign:"center"}]},"MessageFaker v1.0.0 for Kettu/Bunny/Vendetta"))}a.storage.enabled??=!0,a.storage.debug??=!1,a.storage.persistentMessages??={},a.storage.autoInjectOnStartup??=!0,a.storage.preventMessageDeletion??=!0;const k=[];let w=null,A=null,ee=null,O=null,c=null,F=null,D=null;const u=function(e,t){a.storage.debug&&b.logger.log(`[MessageInjector] ${e}`,t||"")},d=function(e,t){b.logger.error(`[MessageInjector] ${e}`,t||"")},G=function(e){return new Promise(function(t){return setTimeout(t,e)})};function v(e,t=[]){for(const n of e)try{const r=B.findByStoreName(n);if(r&&(t.length===0||t.every(function(g){return typeof r[g]=="function"})))return u(`Found store: ${n}`),r}catch{}if(t.length>0)try{const n=B.findByProps(...t);if(n)return u(`Found store by props: ${t.join(", ")}`),n}catch{}return null}async function te(e){try{if(A){const t=A.getUser?.(e);if(t)return{username:t.username||"Unknown User",discriminator:t.discriminator||"0",avatar:t.avatar?`https://cdn.discordapp.com/avatars/${e}/${t.avatar}.png`:null}}}catch(t){d("Failed to get user info",t)}return{username:"Unknown User",discriminator:"0",avatar:null}}function se(e){try{if(w?.getDMFromUserId){const t=w.getDMFromUserId(e);return u(`DM channel for user ${e}: ${t}`),t}}catch(t){d("Failed to get DM channel",t)}return null}function ae(){return`${Date.now()}${Math.random().toString(36).substring(2,11)}`}async function ne(e){let t=e.username,n=e.avatar;if(!t){const g=await te(e.userId);t=g.username,n||(n=g.avatar??void 0)}const r={id:e.messageId||ae(),channel_id:e.channelId,author:{id:e.userId,username:t||"Unknown User",discriminator:"0",avatar:n??void 0,bot:!1,public_flags:0},content:e.content||"",timestamp:e.timestamp||new Date().toISOString(),edited_timestamp:null,tts:!1,mention_everyone:!1,mentions:[],mention_roles:[],attachments:[],embeds:e.embed?[e.embed]:[],reactions:[],pinned:!1,type:0,flags:0};return u("Created message object",r),r}function P(e){if(!s.FluxDispatcher)return d("FluxDispatcher not available"),!1;try{return s.FluxDispatcher.dispatch({type:"MESSAGE_CREATE",channelId:e.channel_id,message:e,optimistic:!1,sendMessageOptions:{},isPushNotification:!1}),u("Message injected successfully",e.id),!0}catch(t){return d("Failed to inject message",t),!1}}function j(){try{a.storage.persistentMessages=JSON.parse(JSON.stringify(a.storage.persistentMessages)),u("Saved persistent messages",Object.keys(a.storage.persistentMessages).length)}catch(e){d("Failed to save persistent messages",e)}}async function L(e){try{let t=e.channelId;if(!t&&e.targetUserId&&(t=se(e.targetUserId)),!t)return d("No valid channel ID found"),o.showToast&&o.showToast("Failed: Could not find DM channel","Small"),!1;const n=await ne({channelId:t,userId:e.fromUserId,content:e.content,username:e.username,avatar:e.avatar,embed:e.embed});e.persistent&&(a.storage.persistentMessages[t]||(a.storage.persistentMessages[t]=[]),a.storage.persistentMessages[t].push(n),j(),u("Message saved to persistent storage",n.id));const r=P(n);return r&&u("Fake message sent successfully"),r}catch(t){return d("Failed to send fake message",t),o.showToast&&o.showToast("Failed to send fake message","Small"),!1}}function f(e){if(!a.storage.persistentMessages[e])return;const t=a.storage.persistentMessages[e];u(`Reinjecting ${t.length} messages for channel ${e}`),t.forEach(function(n,r){setTimeout(function(){P(n)},r*50)})}function re(){try{if(!s.FluxDispatcher)return;const e=W.before("dispatch",s.FluxDispatcher,function(t){if(!a.storage.enabled)return;const n=t[0];if(!(!n||!n.type)){if(a.storage.preventMessageDeletion&&n.type==="MESSAGE_DELETE"){const r=n.id,g=n.channelId;if(g&&a.storage.persistentMessages[g]){const m=a.storage.persistentMessages[g].find(function(T){return T.id===r});m&&(u("Prevented deletion of fake message",r),t[0]={type:"NOOP"},setTimeout(function(){return P(m)},50))}}if(a.storage.preventMessageDeletion&&n.type==="MESSAGE_DELETE_BULK"){const r=n.channelId;if(r&&a.storage.persistentMessages[r]){const g=n.ids||[];a.storage.persistentMessages[r].some(function(m){return g.includes(m.id)})&&(t[0]={type:"NOOP"},setTimeout(function(){return f(r)},100))}}if(n.type==="LOAD_MESSAGES_SUCCESS"||n.type==="LOAD_MESSAGES"){const r=n.channelId;r&&a.storage.persistentMessages[r]&&(setTimeout(function(){return f(r)},200),setTimeout(function(){return f(r)},500),setTimeout(function(){return f(r)},1e3))}if((n.type==="CACHE_LOADED"||n.type==="OVERLAY_INITIALIZE"||n.type==="CHANNEL_UPDATES")&&c&&a.storage.persistentMessages[c]&&setTimeout(function(){return c&&f(c)},300),(n.type==="USER_PROFILE_MODAL_OPEN"||n.type==="USER_PROFILE_MODAL_CLOSE"||n.type==="LAYER_PUSH"||n.type==="LAYER_POP"||n.type==="TYPING_START"||n.type==="TYPING_STOP")&&c&&a.storage.persistentMessages[c]&&(setTimeout(function(){return c&&f(c)},50),setTimeout(function(){return c&&f(c)},300)),n.type==="MESSAGE_UPDATE"){const r=n.message?.channel_id;r&&a.storage.persistentMessages[r]&&setTimeout(function(){return f(r)},100)}}});k.push(e),u("Message persistence system setup with comprehensive event coverage")}catch(e){d("Failed to setup message persistence",e)}}function oe(){F=setInterval(function(){if(O)try{const e=O.getChannelId?.();e&&e!==c&&(c=e,a.storage.persistentMessages[e]&&(f(e),setTimeout(function(){f(e)},200)))}catch{}},1e3),D=setInterval(function(){c&&a.storage.persistentMessages[c]&&f(c)},2e3)}function N(){a.storage.persistentMessages={},j(),u("Cleared all persistent messages"),o.showToast&&o.showToast("All fake messages cleared","Check")}function $(e){a.storage.persistentMessages[e]&&(delete a.storage.persistentMessages[e],j(),u(`Cleared messages for channel ${e}`),o.showToast&&o.showToast("Channel messages cleared","Check"))}function V(){return a.storage.persistentMessages}async function K(e,t){return await L({targetUserId:e,fromUserId:t,content:"Test message from Message Injector plugin!",persistent:!0})}async function ie(){try{w=v(["ChannelStore"],["getChannel","getDMFromUserId"]),A=v(["UserStore","CurrentUserStore"],["getUser","getCurrentUser"]),ee=v(["MessageStore"],["getMessages","getMessage"]),O=v(["SelectedChannelStore"],["getChannelId"]);const e=w&&A;return e?u("All critical modules loaded"):d("Some modules failed to load"),e}catch(e){return d("Failed to initialize modules",e),!1}}var le={onLoad:async function(){try{if(b.logger.log("[MessageInjector] Loading..."),await G(1e3),!await ie()){d("Failed to load critical modules"),o.showToast&&o.showToast("Plugin failed to load","Small");return}if(re(),oe(),a.storage.autoInjectOnStartup){await G(2e3);const e=Object.keys(a.storage.persistentMessages).length;e>0&&(u(`Auto-injecting messages for ${e} channels`),Object.keys(a.storage.persistentMessages).forEach(function(t){setTimeout(function(){f(t)},500)}))}window.__MESSAGE_FAKER__={fakeMessage:L,clearAllMessages:N,clearChannelMessages:$,getAllMessages:V,quickTest:K,reinjectChannel:f,getStatus:function(){return{enabled:a.storage.enabled,messageCount:Object.values(a.storage.persistentMessages).reduce(function(e,t){return e+t.length},0),channelCount:Object.keys(a.storage.persistentMessages).length}}},b.logger.log("[MessageInjector] Loaded successfully"),o.showToast&&o.showToast("Message Injector loaded!","Check")}catch(e){d("Fatal error during load",e),o.showToast&&o.showToast("Plugin failed to load","Small")}},onUnload:function(){try{for(const e of k)try{e()}catch{}k.length=0,F&&(clearInterval(F),F=null),D&&(clearInterval(D),D=null),window.__MESSAGE_FAKER__&&delete window.__MESSAGE_FAKER__,b.logger.log("[MessageInjector] Unloaded"),o.showToast&&o.showToast("Plugin unloaded","Check")}catch(e){d("Error during unload",e)}},settings:X};return h.clearAllMessages=N,h.clearChannelMessages=$,h.default=le,h.fakeMessage=L,h.getAllMessages=V,h.quickTest=K,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro.common,vendetta.metro,vendetta.patcher,vendetta.plugin,vendetta.ui.toasts,vendetta,vendetta.ui.components,vendetta.storage);
